configuration:
  dependencies:
    - "mvn://com.walmartlabs.concord.plugins.basic:ansible-tasks:1.91.0"

  arguments:
    ansibleStatFile: "_attachments/ansible_stats.json"
    concordPid: ${txId}
    errorMessage: ""

forms:
  manualServiceInfoCheckform:
    - initiative: { label: "Product Initiative", type: "string", allow: [ "hawkeye-goldenarcher-fk" ]}
    - environment: { label: "Deployment Environment", type: "string+", allow: [ "Development", "QA", "Stage", "Performance", "Production" ]}
    - groupId: { label: "Product Group Identifier", type: "string"}
    - artifactId: { label: "Product Artifact Identifier", type: "string" }
    - version: { label: "Product Version", type: "string" }
    - packaging: { label: "Deployment Type", type: "string", allow: [ "jar", "tar", "zip"] }

  manualServiceConfigurationCheckform:
    - configurationsRequired: { label: "Service requires configurations for ${targetEnvironment}?", type: "boolean" }

  manualServiceConfigurationDetailform:
    - configurationType: { label: "Configuration Type", type: "string", allow: [ "CCM", "CCM2" ]}
    - configurationBaseUrl: { label: "Configuration Base URL", type: "string" }

flows:
  default:
    - log: "Process ID is ${concordPid}"
    - form: manualServiceInfoCheckform
    - set:
        targetInitiative: ${manualServiceDeployCheckform.initiative}
        targetEnvironment: ${manualServiceDeployCheckform.environment}
        groupId: ${manualServiceDeployCheckform.groupId}
        artifactId: ${manualServiceDeployCheckform.artifactId}
        version: ${manualServiceDeployCheckform.version}
        packaging: ${manualServiceDeployCheckform.packaging}
    - log: "Service requires configurations?"
    - form: manualServiceConfigurationCheckform
    - set:
        configurationsNeeded: ${manualServiceConfigurationCheckform.configurationsRequired}
    - if: ${configurationsNeeded}
      then:
        - form: manualServiceConfigurationDetailform
        - set:
            configurationType: ${manualServiceConfigurationDetailform.configurationType}
            configurationBaseUrl: ${manualServiceConfigurationDetailform.configurationBaseUrl}
      else:
        - log: "Configuration value is set to ${configurationsNeeded} ..... skipping"
    
